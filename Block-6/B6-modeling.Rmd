# Modeling dynamics


<div style="float:right;">[![](www/icons/edit.png)](https://github.com/ProjectMOSAIC/MOSAIC-Calculus/blob/main/Block-6/B6-modeling.Rmd)</div>

5. Models leading to flow fields
    a. Objectives/topics
        i. Apply modeling techniques (from block 2) local low order polynomials
        i. Predatory/Prey (flow fields and the phenomena of the trajectories)
        i. SIR (flow fields and the phenomena of the trajectories)
        i. The differences between these two models
6. Additional models and flow fields (catch up day)
    a. Objectives/topics
        i. (Richardsonâ€™s arms race model and conflict model, action potentials) Numerics, look at the trajectories 
        i. Exercise: `insert_calcZ_exercise("XX.XX", "iRZfBY", "Exercises/walnut-tell-pot.Rmd")`
        i. Analysis of phase plane with nullclines


There are a few differential-equation forms that show up again and again in modeling problems. We're going to introduce them to you here and, later, show you the solutions.

- Growth
- Limited growth
- Change proportional to difference: Newton's law of cooling. 
- Ignition (ape-grow-oven)

**The proportional growth/decay model**: $\dot{x} = a x$

* Simple population growth. The population is a function of time: $x(t)$. Growth at any instant is proportional to the instantaneous population. For instance a population growing at 3% per year will have $a \approx 0.03$ with units 1/year.
* Radioactive decay. The amount of the radioactive substance is a function of time: $x(t)$. For example, phosphorus-32 (that is, $^{32}$P) has a half life of 14 days. The differential equation is $\dot{x} = -a x$ with $a \approx 0.049$ with units 1/day. `r mark(6295)`

**Change proportional to  difference**: $\dot{x} = - a (x - x_\text{fixed})$

* Newton's Law of Cooling is about how a hot (or cold) object comes into equilibrium with the ambient temperature. For instance, you might have a cup of coffee at $200^\circ$F in a room at $70^\circ$F. Unless you drink it, the coffee will cool with time until it reaches the room's temperature. In this setting, $x_\text{fixed} = 70^\circ$F. The value of $a$ depends on how insulated the cup is (and details of evaporation, etc.). But if the coffee reaches very near to room temperature in 60 minutes, $a \approx 0.5$ with units 1/minute. `r mark(6300)`


```{r basic2a, echo=FALSE, results="markup"}
askMC(
  "What are the units of the output of $x(t)$?",
  "degrees F per minute",
  "+degrees F+",
  "1/minute",
  "1/degrees F"
)
```

```{r basic2b, echo=FALSE, results="markup"}
askMC(
  "What are the units of $\\dot{x}$?",
  "+degrees F per minute+",
  "degrees F",
  "1/minute",
  "1/degrees F"
)
```

```{r basic2c, echo=FALSE, results="markup"}
askMC(
  "What is $x$?",
  "the room temperature",
  "the initial temperature of the coffee",
  "+the instantaneous coffee temperature as a function of time+",
  "the fixed rate at which the coffee cools",
  "the instantaneous rate at which the coffee cools as a function of time"
)
```

```{r basic2d, echo=FALSE, results="markup"}
askMC(
  "What is $\\dot{x}$?",
  "the room temperature",
  "the initial temperature of the coffee",
  "the instantaneous coffee temperature as a function of time",
  "+the instantaneous rate at which the coffee cools as a function of time+"
)
```

**Limited growth**, e.g. $\dot{x} = r x (1-x/k)$

The proportional-growth model will lead to $x(t)$ increasing without limit. Sometimes that's a good model over short times, before $x(t)$ has a chance to get unrealistically big. But over long periods of time, something's gotta give. `r mark(6305)`

* Population with a "carrying capacity." For $t$ when $x(t)$ is very small, the population growth is well approximated by the usual proportion-growth model.  For intermediate $t$, the population has grown to a large enough size that it is consuming a substantial fraction of the available resources and population growth slows. When the population reaches the "carrying capacity" the growth stops (e.g. birth rate = death rate). `r mark(6310)`

```{r basic3a, echo=FALSE, results="markup"}
askMC(
  "If the units of $x(t)$ is, say, rabbits, what is the units of $k$?",
  "+rabbits+",
  "rabbits per day",
  "rabbits per week",
  "rabbits per year"
)
```

```{r basic3b, echo=FALSE, results="markup"}
askMC(
  "Suppose the units of $\\dot{x}$ is, rabbits per month, what is the units of $r$?",
  "+1/month+",
  "rabbits per month",
  "months per rabbit",
  "rabbits per month-squared"
)
```

```{r basic3c, echo=FALSE, results="markup"}
askMC(
  "Even without finding the full solution $x(t)$ to the differential equation, you can figure out how big the population will be when growth falls to zero. How big?",
  "+$k$+",
  "$k/r$",
  "$r/k$",
  "$1/r$"
)
```

## Warfare

Differential equations provide a medium for expressing engineering and physics ideas, as well as ideas in many other fields. Frederick William Lanchester (1868-1946) was a British engineer, considered one of the greats of British automotive engineering. But that hardly does justice to him. `r mark(6810)`

While voyaging across the Atlantic to America, he became captivated by the gliding flight of herring gulls. This led to his development of his circulation theory of flight, a foundation of aerofoil theory. In 1906 he published *Aerial Flight* containing the first full theory of lift and drag. In *Aerodonetics* (1908) he developed his phugoid theory of aircraft stability, describing oscillations and stalls. `r mark(6815)`

In 1914, Lanchester wrote a book-length series of journal articles that were published in 1916 as *Aircraft in Warfare: the Dawn of the Fourth Arm*. Imagine trying to theorize about a form of conflict that had never been seen!
The difficulty ... is that in order to get the future into true perspective, it is necessary to be able to look forward along two parallel lines of development---i.e. to visualize the improvement of aircraft possible in the near future as a matter of engineering development, and simultaneously to form a live conception of what this improvement and evolution will open up in the potentialities of the machine as an instrument of war. (p.3) `r mark(6820)`

As a small part of his theorizing, Lanchester introduced a simple mathematical theory of combat now known as Lanchester's Laws. He imagined two opposing forces, Red and Blue, of size $R$ and $B$ and fighting effectiveness $r$ and $b$ respectively. (Both $r$ and $b$ are positive numbers. Indeed, neither $R$ nor $B$ can ever become negative.) The rules of attrition are that losses to Blue are proportional to the size of Red, and vice versa. `r mark(6825)`

<div style="font-size: 30px; text-align:center;">
$$\dot{B} = - r R\\
\dot{R} = - b B$$
</div>

This dynamical system has a fixed point at (0, 0): no forces, no fighting.

The eigenvalues of the system are $\lambda_{1,2} = \pm \sqrt{rb}$

```{r lanch-1, echo=FALSE, results="markup"}
askMC(
  "Which of the three flows below corresponds to Lanchester's Law?",
  "+A+", "B", "C",
  random_answer_order = FALSE
)
```

```{r echo=FALSE, out.width="50%", fig.show="keep"}
math141Z::streamlines(list(~ 0.001*R -2*B, ~ .001*B-R), 
                      domain(R=c(-1,5), B=c(-1, 5)), nsteps=15, stepsize=0.01) %>%
  gf_refine(coord_fixed(x=c(-1,5), y=c(-1,5), clip="on")) %>%
  gf_labs(title="(A)")

math141Z::streamlines(list(~ 0.001*R +B/2, ~ .001*B-R), 
                      domain(R=c(-1,5), B=c(-1, 5)), nsteps=15, stepsize=0.01) %>%
  gf_refine(coord_fixed(x=c(-1,5), y=c(-1,5), clip="on")) %>%
  gf_labs(title="(B)")

math141Z::streamlines(list(~ 0.001*R +B/2, ~ .001*B+R), 
                      domain(R=c(-1,5), B=c(-1, 5)), nsteps=15, stepsize=0.01) %>%
  gf_refine(coord_fixed(x=c(-1,5), y=c(-1,5), clip="on")) %>%
  gf_labs(title="(C)")

```

```{r lanch-2, echo=FALSE, results="markup"}
askMC(
  "Which of these sentences best describes the dynamics of Lanchester's Law?",
  "Both forces battle to complete annihilation.",
  "+The stronger force wipes out the weaker force.+",
  "The weaker force holds off the stronger force."
)
```

Lanchester's Law has a surprising consequence for measuring the overall strength of a force in a way that combines size ($R$ and $B$) and effectiveness ($r$ and $b$) and the implications that has for tactics. `r mark(6830)`

The motivating idea is to find some quantity based on $R$, $B$, $r$, and $b$ that **does not change in time**, even as $R$ and $B$ change. This is called a *conserved quantity*. Here's one candidate

$$rR^2 - b B^2 \overset{?}{=} \text{constant}$$
How can you see that this is conserved? Differentiate it with respect to time. If that derivative is zero, then the quantity doesn't change in time. We'll do this in two parts:

```{r lanch3, echo=FALSE, results="markup"}
askMC(
  "Calculate $\\partial_t r R^2$. Which of these is right? (Hint: Use the chain rule of differentiation and Lanchester's equations to simplify more.)",
  "+$-2 rb RB$+",
  "$2rR$",
  "$-2r\\dot{R}$",
  "$2r\\dot{R} B$ "
)
```

```{r lanch4, echo=FALSE, results="markup"}
askMC(
  "Perform the similar calculation  $\\partial_t b B^2$. Is it the case that $\\partial_t r R^2 = \\partial_t b B^2$?",
  "+Yes+",
  "No",
  "Depends on $b$ and $r$.",
  "Depends on $B$ and $R$.",
  random_answer_order=FALSE
)
```

Here are two more candidates for conserved quantities:

a. $rR - bB$
b. $rB - bR$

Take the derivative with respect to time of each of them to determine if they are conserved.

```{r lanch5, echo=FALSE, results="markup"}
askMC(
  "Which of (a) and (b) are conserved?",
  "Just (a).",
  "Just (b).",
  "Both (a) and (b).",
  "+Neither (a) nor (b).+",
  random_answer_order = FALSE
)
```

The conservation of $rR^2 - b B^2$ suggests that we measure a force's strength as effectiveness $\times$ size$^2$. As battle proceeds, the strength of each force goes down at the same rate until the battle is over.  `r mark(6835)`

One implication of this is that a single force of size 2 is twice as strong as two separate forces each of size 1.  Don't split your own forces. Stay in formation! Seek to split your opponent's forces. `r mark(6840)`

## Arms race

Lewis Fry Richardson (1881-1953) was an English scientist who worked
in many areas, including weather prediction.  This problem concerns a
model Richardson built to account for arms races between countries.

In the model, $x$ and $y$ respectively refer to the size of the
military of the two countries.  The equations model how the size of
the militaries change in time:
<div style="font-size: 30px; text-align:center;">
$$\begin{eqnarray*}
\dot{x} & = & a y - m x + r\\
\dot{y} & = & b x - n y + s\\
\end{eqnarray*}$$
</div>

The terms $r$ and $s$ represent the basic grievances between the two countries.

The parameters $a$ and $b$ represent "fear," that is, the extent to which one country feels the need to build up arms in response to the other country's arms.

The parameters $m$ and $n$ are about the internal dynamics of the
country: its ability/desire to sustain a large military.

```{r arms1, echo=FALSE}
askMC(
  "What should the signs of $r$ and $s$ be  if the countries have substantial grievances against each other?",
  "+positive+", "negative", "zero",
  random_answer_order = FALSE
)
```

```{r arms2, echo=FALSE}
askMC(
  "What should be the signs of $a$ and $b$, given that they represent 
  \"fear?\"",
   "+positive+", "negative", "zero",
  random_answer_order = FALSE
)
```


```{r arms3, echo=FALSE}
askMC(
  "What should be the signs of $m$ and $n$, in a country which, on its own, would not like to build a large military? Note the sign preceeding these terms.",
  "+positive+", "negative", "zero",
  random_answer_order = FALSE
)
```

```{r echo = FALSE}
scenario1 = function(x,y) {
  dx = 2*y - 5*x + 5
  dy = 2*x - 3*y + 5
  return( c(dx=dx,dy=dy) )
  }
scenario2 = function(x,y) {
 dx = 2*y - 1*y + 3
 dy = 2*x - 2*y + 3
 return( c(dx=dx,dy=dy) )
 }
wrong.scenario2 = function(x,y) {
 dx = -2*y - 1*x + 3
 dy = 2*x - 2*y + 3
 return( c(dx=dx,dy=dy) )
 }
```

```{r echo = FALSE, out.width="70%", fig.show="hold"}
DOM <- domain(x = c(0, 4), y = c(0, 4))
math141Z::streamlines(
  list( ~ -2*y - x + 3,
        ~ 2*x - 2*y + 3),
  DOM, 
  stepsize=0.005
) %>%
  gf_labs(x = "Freedonia arms",
          y = "Jockavia arms",
          title = "Flow field (A)")

math141Z::streamlines(
  list( ~ 2*y - 1*y + 3,
        ~ 2*x - 2*y + 3),
  DOM, 
  stepsize=0.005
) %>%
  gf_labs(x = "Freedonia arms",
          y = "Jockavia arms",
          title = "Flow field (B)")

math141Z::streamlines(
  list( ~ 2*y - 5*x + 5,
        ~ 2*x - 3*y + 5),
  DOM, 
  stepsize=0.002
) %>%
  gf_labs(x = "Freedonia arms",
          y = "Jockavia arms",
          title = "Flow field (C)")
```


Depending on the values of the parameters $a$, $b$, $m$, $n$, $r$, and $s$, the Richardson dynamics can produce different outcomes.  Two of the previous three plots show Richardson Arms Race dynamics for two mutually fearful countries with  mutual grievances, Freedonia and Jockavia.  The third plot does not; the signs of one of the coefficients has been reversed and so the dynamics don't make sense for modeling an arms race. `r mark(6945)`

a. In each of the three plots, start from initial point $x=2,y=1$,   that is, a situation where Freedonia is more armed than Jackavia, and trace out the trajectory over time.
b. For each of the three plots, find any equilibrium point and say   whether it is stable or unstable.  If there is no equilibrium, move on.
c. Identify which of the three plots is NOT the Richardson dynamics.
d. In the non-Richardson flow, which coefficient has been reversed: it's one of $a$, $b$, $m$, $n$, $r$, or $s$.

```{r arms4, echo=FALSE}
askMC(
  "Which of the previous plots are Not the Richardson Dynamics?",
  "+Flow Field A+", "Flow Field B", "Flow Field C",
  random_answer_order = FALSE
)
```

```{r arms5, echo=FALSE}
askMC(
  "In this plot which if the parameters is reversed?",
  "+a+", "b", "m", "n", "r", "s",
  random_answer_order = FALSE
)
```

## Competition

Our model for strong competition is
$$\partial_t x =  x(3 âˆ’ x âˆ’ y)\\
\partial_t y = y(4 âˆ’ y âˆ’ 2x)$$
and for weak competition we take
$$\partial_t x= x(4 âˆ’ y âˆ’ 2x)\\
\partial_t y = y(3 âˆ’ x âˆ’ y)\ .$$

## Epidemic

A differential equation model of the spread of contagious disease in order to make sense of the past, the prognosis of the COVID pandemic, and to examine the impact of policies such as social distancing and vaccination.

The model we will use and develop is called the *SIR-model*. The name reflects the three population groups at the core of the model: people *susceptible* to infection, people who are currently *infective*, and people who had the disease but are no longer infective, the so-called *recovered* group. That we implement the model using differential equations should in no way be interpreted as our having captured in detail the real-world mechanisms of contagion. The SIR model can at best make only rough, tentative approximations to the future course of an epidemic. There are many important phenomena completely outside the scope of the model, such as the evolution of new variants of the virus, the role of super-spreader events, and so on. That being said these *SIR-models* are commonly used including by the Pandemic Math Team which helps model the pandemic at USAFA and has served as a standard for the pandemic response across the Air Force.

The utility of the model is not for detailed prediction. Instead, the model provides 

* a framework for translating limited information from various sources into a format that can be compared to typical (incomplete) records of disease spread over time
* estimates of the population fraction who remain susceptible at the end of an outbreak and how this might be influenced by various public-health interventions
* information about the possibility of the disease becoming *endemic*, that is, a permanent feature of the environment

The model, like many others we've seen, consists of a *state* that describes the instantaneous "position" of the system and dynamical rules that describe the instantaneous *rate of change* of the state as a function of the state itself. In constructing the dynamical rules, we'll take note of an appropriate time scale, and we'll follow the pattern of using *parsimonious*, *low-order polynomials*.

We'll imagine the state as consisting of the number of people in three different *compartments*:

- people who are susceptible $S$
- people who are currently infective $I$
- people who are neither susceptible or infective, who we lump under the name "recovered" $R$. 

The dynamical rules describe the rates at which people move from one compartment to another. Those flows are rooted in some basic, everyday biology:

i. contact between infective and susceptible people will, at some level of probability, convert a susceptible into an infective.
ii. after a characteristic amount of time, infective people no longer remain infective and enter the "recovered" compartment.

Schematically, the flows are *one-way* only:

*Susceptible* $\implies$ *Infective* $\implies$ *Recovered*

Other patterns of flow might be appropriate depending on the circumstances. For instance, at the time of writing (March 2021) there is uncertainty whether those recovered from COVID might at some time regain susceptibility. Another sort of flow is evidenced by a very recent Ebola transmission [traced to a person who had again become infective after recovering five years previously](https://www.sciencemag.org/news/2021/03/new-ebola-outbreak-likely-sparked-person-infected-5-years-ago). In some diseases---herpes, malaria---people can be *latent* carriers whose infectiveness comes and goes over periods of month or years.

With COVID, we have seen large scale changes in the number of sick on a time scale of months or seasons. Since overall population changes little on that time scale, we start with an assumption that the model does not have to incorporate birth rates.


Now to describe the dynamics in a population of size $N$:

The susceptible compartment has no inward flow. The outward flow is governed by the interaction between susceptibles and infectives. This gives simply $$\dot{S} = - \beta \frac{S I}{N}$$
Think of $S I$ as the total number of theoretically possible contacts each day between susceptibles and infectives. Each susceptible person could in principle meet any of the $I$ infectives. since there are $S$ different susceptibles, the total number of potential meetings is $SI$. The negative sign is because the people are *leaving* the compartment (Once again the flow is one way, so no one becomes susceptible).

What's the $N$ doing in $\beta \frac{S I}{N}$? Suppose the $N$ weren't there. Then the dimension of $\beta$ would need to be $T^{-1} \mbox{people}^{-1}$ in order to produce the units of $\dot{S}$ which are $\mbox{people}/T$. It's convenient to be able to make an estimate of $\beta$ in a population of one size and be able to apply it to a population of another size. The $N$ takes care of this for us. 

Hardly any of these potential meetings ever happens. And even if a meeting does happen, it will not necessarily lead to the susceptible becoming infective. All of this is meant to be captured by the parameter $\beta$, for which we anticipate that $\beta$ is much less than 1 (that is, $\beta \ll 1)$.

The infective compartment has a flow in and another flow out. The flow in is exactly those same people who flowed out of the susceptible compartment, the rate of which is $\beta\,SI$. But the infective people eventually recover. This will be represented as a term $\alpha I$, giving

$$\dot{I} = \beta\, \frac{S I}{N} - \alpha I$$
Why divide by $N$? We'd like $\beta$ to tell us about how fast the epidemic spreads. So it should have dimension of $1/time$. 



Finally, the $\alpha I$ recovery is a flow *into* the recovered compartment:

$$\dot{R} = \alpha I$$

Only two unknown parameters: $\alpha$ and $\beta$. N is the size of the population, which we know.

## Nerve pulses 

Action potential

https://www.ncbi.nlm.nih.gov/pmc/articles/PMC1366333/pdf/biophysj00662-0010.pdf

Fitzhugh-Nagumo. $v$ is membrane potential, $w$ is accomodation and refractoriness.

Domain: $-2.5 \leq v \leq 2.5$ and $-1 \leq w \leq 2$, params $I_{\rm {ext}}=0.5,a=0.8,b=0.7, \tau=12.5$

$$\begin{array}{rcl}
\partial_t {v} & = & v-\frac{v^3}{3} - w + RI_{\rm ext} 
\\
\tau \partial_t {w} & = & v+a-b w
\end{array}
$$


## Feedback

## Exercises


`r insert_calcZ_exercise("XX.XX", "L6hTUu", "Exercises/pine-win-oven.Rmd")`

`r insert_calcZ_exercise("XX.XX", "VCWRBs", "Exercises/seal-fly-socks.Rmd")`

`r insert_calcZ_exercise("XX.XX", "BbcPyk", "Exercises/finch-look-dish.Rmd")`



