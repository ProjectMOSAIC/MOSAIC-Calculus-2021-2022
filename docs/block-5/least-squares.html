<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 42 Least Squares | MOSAIC-Calculus.knit</title>
  <meta name="description" content="" />
  <meta name="generator" content="bookdown 0.24.1 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 42 Least Squares | MOSAIC-Calculus.knit" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 42 Least Squares | MOSAIC-Calculus.knit" />
  
  
  




  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="target-problem.html"/>

<script src="libs/header-attrs-2.11/header-attrs.js"></script>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>
<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />
<script src="libs/htmlwidgets-1.5.4/htmlwidgets.js"></script>
<link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet" />
<script src="libs/datatables-binding-0.18/datatables.js"></script>
<link href="libs/dt-core-1.10.20/css/jquery.dataTables.min.css" rel="stylesheet" />
<link href="libs/dt-core-1.10.20/css/jquery.dataTables.extra.css" rel="stylesheet" />
<script src="libs/dt-core-1.10.20/js/jquery.dataTables.min.js"></script>
<link href="libs/crosstalk-1.2.0/css/crosstalk.min.css" rel="stylesheet" />
<script src="libs/crosstalk-1.2.0/js/crosstalk.min.js"></script>
<span class="math inline">
\(\newcommand{\line}{\text{line}}
\newcommand{\hump}{\text{hump}}
\newcommand{\sigmoid}{\text{sigmoid}}
\newcommand{\recip}{\text{recip}}
\newcommand{\diff}[1]{{\cal D}_#1}
\newcommand{\pnorm}{\text{pnorm}}
\newcommand{\dnorm}{\text{dnorm}}
\newcommand{\CC}[1]{\color{#648fff}{#1}}
\newcommand{\CE}[1]{\color{#785ef0}{#1}}
\newcommand{\CA}[1]{\color{#dc267f}{#1}}
\newcommand{\CB}[1]{\color{#fe6100}{#1}}
\newcommand{\CD}[1]{\color{#ffb000}{#1}}\)
</span>






<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="mosaic-calc-style-copy.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="../docs/welcome-to-calculus.html">Welcome to calculus</li>
<li><a href="../block-1/change.html">Block 1: Functions & quantities</a></li>
<li><a href="../block-2/change-relatonships.html">Block 2: Differentiation</a></li>
<li><a href="../block-3/change-accumulation.html">Block 3: Accumulation</a></li>
<li><a href="../block-4/block4-intro.html">Block 4: Manifestations</a></li>
<hr>
<li><strong><a href="./">Block 5: Linear combinations</strong></a></li>

<li class="divider"></li>
<li class="chapter" data-level="38" data-path="vectors-draft.html"><a href="vectors-draft.html"><i class="fa fa-check"></i><b>38</b> Vectors Draft</a>
<ul>
<li class="chapter" data-level="38.1" data-path="vectors-draft.html"><a href="vectors-draft.html#length-direction"><i class="fa fa-check"></i><b>38.1</b> Length &amp; direction</a></li>
<li class="chapter" data-level="38.2" data-path="vectors-draft.html"><a href="vectors-draft.html#the-nth-dimension"><i class="fa fa-check"></i><b>38.2</b> The n<sup>th</sup> dimension</a></li>
<li class="chapter" data-level="38.3" data-path="vectors-draft.html"><a href="vectors-draft.html#geometry-arithmetic"><i class="fa fa-check"></i><b>38.3</b> Geometry &amp; arithmetic</a></li>
<li class="chapter" data-level="38.4" data-path="vectors-draft.html"><a href="vectors-draft.html#angles"><i class="fa fa-check"></i><b>38.4</b> Angles</a></li>
<li class="chapter" data-level="38.5" data-path="vectors-draft.html"><a href="vectors-draft.html#orthogonality"><i class="fa fa-check"></i><b>38.5</b> Orthogonality</a></li>
<li class="chapter" data-level="38.6" data-path="vectors-draft.html"><a href="vectors-draft.html#exercises"><i class="fa fa-check"></i><b>38.6</b> Exercises</a></li>
<li class="chapter" data-level="38.7" data-path="vectors-draft.html"><a href="vectors-draft.html#outline"><i class="fa fa-check"></i><b>38.7</b> Outline</a></li>
</ul></li>
<li class="chapter" data-level="39" data-path="linear-combs-vectors.html"><a href="linear-combs-vectors.html"><i class="fa fa-check"></i><b>39</b> Linear combinations of vectors</a>
<ul>
<li class="chapter" data-level="39.1" data-path="linear-combs-vectors.html"><a href="linear-combs-vectors.html#scaling"><i class="fa fa-check"></i><b>39.1</b> Scaling</a></li>
<li class="chapter" data-level="39.2" data-path="linear-combs-vectors.html"><a href="linear-combs-vectors.html#sub-spaces"><i class="fa fa-check"></i><b>39.2</b> Sub-spaces</a></li>
<li class="chapter" data-level="39.3" data-path="linear-combs-vectors.html"><a href="linear-combs-vectors.html#functions-as-vectors"><i class="fa fa-check"></i><b>39.3</b> Functions as vectors</a></li>
<li class="chapter" data-level="39.4" data-path="linear-combs-vectors.html"><a href="linear-combs-vectors.html#matrices"><i class="fa fa-check"></i><b>39.4</b> Matrices</a></li>
<li class="chapter" data-level="39.5" data-path="linear-combs-vectors.html"><a href="linear-combs-vectors.html#exercises-1"><i class="fa fa-check"></i><b>39.5</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="40" data-path="projection-residual.html"><a href="projection-residual.html"><i class="fa fa-check"></i><b>40</b> Projection &amp; residual</a>
<ul>
<li class="chapter" data-level="40.1" data-path="projection-residual.html"><a href="projection-residual.html#projecting-a-vector-onto-another-vector"><i class="fa fa-check"></i><b>40.1</b> Projecting a vector onto another vector</a></li>
<li class="chapter" data-level="40.2" data-path="projection-residual.html"><a href="projection-residual.html#projection-onto-a-set-of-vectors"><i class="fa fa-check"></i><b>40.2</b> Projection onto a set of vectors</a></li>
<li class="chapter" data-level="40.3" data-path="projection-residual.html"><a href="projection-residual.html#exercises-2"><i class="fa fa-check"></i><b>40.3</b> Exercises</a></li>
<li class="chapter" data-level="40.4" data-path="projection-residual.html"><a href="projection-residual.html#moved-from-vectors"><i class="fa fa-check"></i><b>40.4</b> MOVED FROM VECTORS</a></li>
<li class="chapter" data-level="40.5" data-path="projection-residual.html"><a href="projection-residual.html#matrix"><i class="fa fa-check"></i><b>40.5</b> Matrix</a></li>
<li class="chapter" data-level="40.6" data-path="projection-residual.html"><a href="projection-residual.html#scalar-multiplication"><i class="fa fa-check"></i><b>40.6</b> Scalar multiplication</a></li>
<li class="chapter" data-level="40.7" data-path="projection-residual.html"><a href="projection-residual.html#dot-product-and"><i class="fa fa-check"></i><b>40.7</b> Dot product and <code>%*%</code></a></li>
<li class="chapter" data-level="40.8" data-path="projection-residual.html"><a href="projection-residual.html#vector-lengths"><i class="fa fa-check"></i><b>40.8</b> Vector lengths</a></li>
<li class="chapter" data-level="40.9" data-path="projection-residual.html"><a href="projection-residual.html#outline-1"><i class="fa fa-check"></i><b>40.9</b> Outline</a></li>
</ul></li>
<li class="chapter" data-level="41" data-path="target-problem.html"><a href="target-problem.html"><i class="fa fa-check"></i><b>41</b> The target problem</a>
<ul>
<li class="chapter" data-level="41.1" data-path="target-problem.html"><a href="target-problem.html#properties-of-the-solution"><i class="fa fa-check"></i><b>41.1</b> Properties of the solution</a></li>
<li class="chapter" data-level="41.2" data-path="target-problem.html"><a href="target-problem.html#the-geometry-of-qr.solve"><i class="fa fa-check"></i><b>41.2</b> The geometry of <code>qr.solve()</code></a></li>
<li class="chapter" data-level="41.3" data-path="target-problem.html"><a href="target-problem.html#finding-the-target-with-qr"><i class="fa fa-check"></i><b>41.3</b> Finding the target with QR</a></li>
</ul></li>
<li class="chapter" data-level="42" data-path="least-squares.html"><a href="least-squares.html"><i class="fa fa-check"></i><b>42</b> Least Squares</a>
<ul>
<li class="chapter" data-level="42.1" data-path="least-squares.html"><a href="least-squares.html#the-data"><i class="fa fa-check"></i><b>42.1</b> The data</a></li>
<li class="chapter" data-level="42.2" data-path="least-squares.html"><a href="least-squares.html#the-fitting-problem"><i class="fa fa-check"></i><b>42.2</b> The fitting problem</a></li>
<li class="chapter" data-level="42.3" data-path="least-squares.html"><a href="least-squares.html#the-residual-vector"><i class="fa fa-check"></i><b>42.3</b> The residual vector</a></li>
<li class="chapter" data-level="42.4" data-path="least-squares.html"><a href="least-squares.html#solving-m-x-b-part-ii"><i class="fa fa-check"></i><b>42.4</b> Solving M x ≈ b: Part II</a></li>
<li class="chapter" data-level="42.5" data-path="least-squares.html"><a href="least-squares.html#lm-and-qr.solve"><i class="fa fa-check"></i><b>42.5</b> <code>lm()</code> and <code>qr.solve</code></a></li>
<li class="chapter" data-level="42.6" data-path="least-squares.html"><a href="least-squares.html#r2-residuals-etc."><i class="fa fa-check"></i><b>42.6</b> R<span class="math inline">\(^2\)</span>, Residuals, etc.</a></li>
<li class="chapter" data-level="42.7" data-path="least-squares.html"><a href="least-squares.html#modern-fitting-the-ridge-and-the-lasso-optional"><i class="fa fa-check"></i><b>42.7</b> Modern fitting: The ridge and the lasso (optional)</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="../block-6/dynamics.html">Block 6: Dynamics</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./"></a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="least-squares" class="section level1" number="5">
<h1><span class="header-section-number">Chapter 42</span> Least Squares</h1>
<div class="underconstruction">
<p>Chapter not yet released.</p>
</div>
<p>It often happens that a model is needed to help organize complex, multivariate data, for purposes such as prediction. The example we will use in this Daily Digital is the measurement of body-fat percentage. It’s thought that this quantity is more useful for monitoring of long-term health than related measures such as weight or body-mass index (BMI).</p>
<p>It’s possible to measure body-fat percentage by an elaborate procedure involving submerging a person in water to measure total body volume, then calculating the persons mass density and converting this to a reading of body-mass percentage. It would be helpful to construct a way of estimating body-fat percentage from easy-to-make measurements such as weight, height, waist circumference, etc.</p>
<p>The overall strategy for developing such a model involves making <em>both</em> the easy-to-make body measurements and the hard-to-make submergence measurement. Then a model function is constructed with the submergence measurement as the output and the easy-to-make measurements as the inputs.</p>
<p>But what form should the function take? One of the most widely used techniques throughout science, industry, medicine, economics, and many other disciplines involves constructing a linear combination of very simple functions of individual variables or sometimes pairs of variables. For instance, for input variables <span class="math inline">\(x\)</span>, <span class="math inline">\(y\)</span>, and <span class="math inline">\(z\)</span>, the simple functions might include</p>
<p><span class="math display">\[f_0(x,  y, z) \equiv 1\\
f_1(x,y,z)\equiv x\\
f_2(x, y, z) \equiv y\\
f_3(x, y, z) \equiv z\\
f_4(x, y, z) \equiv x \cdot y\\
f_5(x, y, z) \equiv x \cdot z\\
\mbox{...  and so on.}
\]</span></p>
<p>We’re going to use the strategy of linear combinations of simple functions to investigate the problem of finding body-fat percentage as a function of easy-to-make measurements.</p>
<div id="the-data" class="section level2" number="5.1">
<h2><span class="header-section-number">42.1</span> The data</h2>
<p>The data we have at hand is a data frame called <code>Body_fat</code> containing measurements on 252 males. The variables in <code>Body_fat</code> include the body-fat percentage (<code>bodyfat</code>), age, weight, height, and body-mass index (<code>bmi</code>) as well as a series of circumferences: around the neck, chest, abdomen, hip, thigh, knee, angle, biceps, forearm, and wrist.</p>
<p>First, a quick demonstration that body-fat percentage is not an obvious simple function of weight or BMI. The commands you will use in this Daily Digital are almost all demonstrated here:</p>
<ul>
<li><code>lm()</code> finds the linear combinations of the inputs that best approximate the output</li>
<li><code>makeFun()</code> reformats the linear combinations as a function suitable for plotting</li>
<li><code>gf_point()</code> and <code>slice_plot()</code> should already be familiar to you</li>
<li><code>rsquared()</code> calculates how close the predictions are to the actual values. The R<span class="math inline">\(^2\)</span> statistic is always in the range 0 to 1. The closer it is to one, the more predictive the model.</li>
</ul>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb46-1"><a href="least-squares.html#cb46-1" aria-hidden="true" tabindex="-1"></a>mod1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(bodyfat <span class="sc">~</span> weight, <span class="at">data =</span> Body_fat)</span>
<span id="cb46-2"><a href="least-squares.html#cb46-2" aria-hidden="true" tabindex="-1"></a>fun1 <span class="ot">&lt;-</span> <span class="fu">makeFun</span>(mod1)</span>
<span id="cb46-3"><a href="least-squares.html#cb46-3" aria-hidden="true" tabindex="-1"></a>mod2 <span class="ot">&lt;-</span> <span class="fu">lm</span>(bodyfat <span class="sc">~</span> bmi,  <span class="at">data =</span>  Body_fat)</span>
<span id="cb46-4"><a href="least-squares.html#cb46-4" aria-hidden="true" tabindex="-1"></a>fun2 <span class="ot">&lt;-</span> <span class="fu">makeFun</span>(mod2)</span>
<span id="cb46-5"><a href="least-squares.html#cb46-5" aria-hidden="true" tabindex="-1"></a><span class="fu">gf_point</span>(bodyfat <span class="sc">~</span> weight,  <span class="at">data =</span> Body_fat) <span class="sc">%&gt;%</span> </span>
<span id="cb46-6"><a href="least-squares.html#cb46-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_plot</span>(<span class="fu">fun1</span>(weight) <span class="sc">~</span> weight)</span>
<span id="cb46-7"><a href="least-squares.html#cb46-7" aria-hidden="true" tabindex="-1"></a><span class="fu">gf_point</span>(bodyfat <span class="sc">~</span> bmi, <span class="at">data  =</span> Body_fat) <span class="sc">%&gt;%</span> </span>
<span id="cb46-8"><a href="least-squares.html#cb46-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_plot</span>(<span class="fu">fun2</span>(bmi) <span class="sc">~</span> bmi)</span>
<span id="cb46-9"><a href="least-squares.html#cb46-9" aria-hidden="true" tabindex="-1"></a><span class="fu">rsquared</span>(mod1)</span></code></pre></div>
<pre><code>## [1] 0.3722742</code></pre>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb48-1"><a href="least-squares.html#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rsquared</span>(mod2)</span></code></pre></div>
<pre><code>## [1] 0.5547538</code></pre>
<p><img src="MOSAIC-Calculus_files/figure-html/unnamed-chunk-43-1.png" width="45%" style="display: block; margin: auto;" /><img src="MOSAIC-Calculus_files/figure-html/unnamed-chunk-43-2.png" width="45%" style="display: block; margin: auto;" /></p>
<p>The graphs show a correlation between <code>bodyfat</code> and both <code>weight</code> and <code>bmi</code> individually. But, at any given weight or any given BMI, there is a big range of body-fat percentage, so clearly <code>bodyfat</code> is not just an alias for weight or BMI. The R<span class="math inline">\(^2\)</span> for the models shows that <code>bmi</code> is a better predictor of body-fat percentage than <code>weight</code>.</p>
<p>You’ve seen enough vector mathematics now to understand exactly what R<span class="math inline">\(^2\)</span> is. When the output-variable vector is <em>exactly perpendicular</em> to the subspace spanned by the input vectors in the linear combination, R<span class="math inline">\(^2\)</span> is zero. When the output-variable vector is <em>completely aligned</em> the the subspace spanned by the input vectors, R<span class="math inline">\(^2\)</span> is one. Between these two extremes, R<span class="math inline">\(^2\)</span> is the cosine-squared of the <em>angle</em> between the output vector and the subspace spanned by the input vectors. There are two very important consequences to this definition:</p>
<ol style="list-style-type: decimal">
<li>If you include a new input vector in the linear combination, the R<span class="math inline">\(^2\)</span> will generally go up (and will certainly never go down). The reason is that the subspace spanned by the expanded model is usually larger (and never smaller) than the subspace spanned by the original model.</li>
<li>If your data has <span class="math inline">\(n\)</span> rows, using <span class="math inline">\(n\)</span> <em>random-number</em> vectors will produce an R<span class="math inline">\(^2\)</span> of 1, because the subspace spanned by the vectors will be the <em>entire vector space</em>. Consequently, regardless of what the output vector is, it will be entirely contained within the input-vector subspace.</li>
</ol>
<p>A small increase in R<span class="math inline">\(^2\)</span> will happen even when the new vector has nothing at all to do with the output vector. In statistics, you will learn what “small” means and how much R<span class="math inline">\(^2\)</span> should go up in order to have a plausible claim that the new vector is meaningfully contributing to the model.</p>
<p>Let’s see how well we can predict <code>bodyfat</code> if we use <em>both</em> weight and <code>bmi</code>.</p>
<div class="sourceCode" id="cb50"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb50-1"><a href="least-squares.html#cb50-1" aria-hidden="true" tabindex="-1"></a>mod3 <span class="ot">&lt;-</span> <span class="fu">lm</span>(bodyfat <span class="sc">~</span> weight <span class="sc">+</span> bmi,  <span class="at">data  =</span> Body_fat)</span>
<span id="cb50-2"><a href="least-squares.html#cb50-2" aria-hidden="true" tabindex="-1"></a>fun3  <span class="ot">&lt;-</span>  <span class="fu">makeFun</span>(mod3)</span>
<span id="cb50-3"><a href="least-squares.html#cb50-3" aria-hidden="true" tabindex="-1"></a><span class="fu">contour_plot</span>(<span class="fu">fun3</span>(weight,  bmi) <span class="sc">~</span> weight <span class="sc">+</span> bmi, </span>
<span id="cb50-4"><a href="least-squares.html#cb50-4" aria-hidden="true" tabindex="-1"></a>             <span class="fu">domain</span>(<span class="at">weight =</span>  <span class="fu">c</span>(<span class="dv">100</span>,<span class="dv">200</span>), <span class="at">bmi =</span>  <span class="fu">c</span>(<span class="dv">15</span>, <span class="dv">35</span>)))</span></code></pre></div>
<p><img src="MOSAIC-Calculus_files/figure-html/unnamed-chunk-44-1.png" width="90%" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb51-1"><a href="least-squares.html#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rsquared</span>(mod3)  <span class="co"># mod3 is bodyfat ~ weight + bmi</span></span></code></pre></div>
<pre><code>## [1] 0.5585916</code></pre>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb53-1"><a href="least-squares.html#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="fu">slice_plot</span>(<span class="fu">fun3</span>(<span class="at">weight =</span> <span class="dv">150</span>, bmi)  <span class="sc">~</span> bmi, <span class="fu">domain</span>(<span class="at">bmi =</span>  <span class="fu">c</span>(<span class="dv">15</span>, <span class="dv">35</span>)))  <span class="sc">%&gt;%</span></span>
<span id="cb53-2"><a href="least-squares.html#cb53-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gf_labs</span>(<span class="at">title =</span> <span class="st">&quot;Holding weight at 150 lbs&quot;</span>)</span></code></pre></div>
<p><img src="MOSAIC-Calculus_files/figure-html/unnamed-chunk-44-2.png" width="90%" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb54"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb54-1"><a href="least-squares.html#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="fu">slice_plot</span>(<span class="fu">fun3</span>(weight, <span class="at">bmi =</span> <span class="dv">30</span>)  <span class="sc">~</span>  weight,  <span class="fu">domain</span>(<span class="at">weight   =</span> <span class="fu">c</span>(<span class="dv">100</span>,<span class="dv">200</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb54-2"><a href="least-squares.html#cb54-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gf_labs</span>(<span class="at">title =</span> <span class="st">&quot;Holding BMI at 30&quot;</span>)</span></code></pre></div>
<p><img src="MOSAIC-Calculus_files/figure-html/unnamed-chunk-44-3.png" width="90%" style="display: block; margin: auto;" /></p>
<p>You can see from the contour graph that at a weight of 150 lbs and a BMI of 25, the predicted body-fat percentage is just a hair under 20%. You can see from the R<span class="math inline">\(^2\)</span> that the two-input model is not any better than the model with just BMI as the input.</p>
<p>The slice plots show, as the name suggests, a slice through the contour plot. In the first slice, the <code>weight</code> is being held constant at 150 lbs. Over the range of BMI shown, the body-fat percentage changes very substantially: from 0 to 40%. That is, BMI has a strong relationship to body fat percentage even when holding weight constant.</p>
<p>The second slice holds the <code>bmi</code> to 25. Over the range of weights, the body-fat percent changes only slightly, from 18% to 21%. Thus, knowing BMI, additional knowledge of weight tells you almost nothing about body fat percentage.</p>
<p>The strategy here is to build a model with multiple inputs, then hold some of those inputs constant while examining the model output with respect to the remaining inputs. This “hold some inputs constant” is a powerful technique for interpreting complex models.</p>
</div>
<div id="the-fitting-problem" class="section level2" number="5.2">
<h2><span class="header-section-number">42.2</span> The fitting problem</h2>
</div>
<div id="the-residual-vector" class="section level2" number="5.3">
<h2><span class="header-section-number">42.3</span> The residual vector</h2>
<p>Residual connects Mx to b. (Review from B5-projection.) Idea of fitting, make the residual as small as possible. Using sum of squares let’s us translate the problem into a projection problem.</p>
</div>
<div id="solving-m-x-b-part-ii" class="section level2" number="5.4">
<h2><span class="header-section-number">42.4</span> Solving M x ≈ b: Part II</h2>
<p>In previous we have found the <code>x</code> for a given <code>M</code> and <code>b</code> using the R function <code>qr.solve(M, b)</code>. This operation of solving is so important in quantitative work in so many fields, that numerous software programs package it up in other ways that make it easy to use.</p>
<p>One example of this re-packaging is the <code>lm()</code> function in R. “<code>lm</code>” stands for “linear modeling,” and not only finds the <code>x</code> that solves M x ≈ b, but also calculates numerous indicators of the statistical reliability of the result. The <code>lm()</code> function is one of the most widely used in R, and R is one of the most widely used software systems for data science, so we’re going to spend a little time with it.</p>
<p>The <code>mtcars</code> data frame shown below records several aspects of the design and performance of some classic cars from 50 years ago.</p>
<div id="htmlwidget-40911b6cd151dcffaa27" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-40911b6cd151dcffaa27">{"x":{"filter":"none","data":[["Mazda RX4","Mazda RX4 Wag","Datsun 710","Hornet 4 Drive","Hornet Sportabout","Valiant","Duster 360","Merc 240D","Merc 230","Merc 280","Merc 280C","Merc 450SE","Merc 450SL","Merc 450SLC","Cadillac Fleetwood","Lincoln Continental","Chrysler Imperial","Fiat 128","Honda Civic","Toyota Corolla","Toyota Corona","Dodge Challenger","AMC Javelin","Camaro Z28","Pontiac Firebird","Fiat X1-9","Porsche 914-2","Lotus Europa","Ford Pantera L","Ferrari Dino","Maserati Bora","Volvo 142E"],[21,21,22.8,21.4,18.7,18.1,14.3,24.4,22.8,19.2,17.8,16.4,17.3,15.2,10.4,10.4,14.7,32.4,30.4,33.9,21.5,15.5,15.2,13.3,19.2,27.3,26,30.4,15.8,19.7,15,21.4],[6,6,4,6,8,6,8,4,4,6,6,8,8,8,8,8,8,4,4,4,4,8,8,8,8,4,4,4,8,6,8,4],[160,160,108,258,360,225,360,146.7,140.8,167.6,167.6,275.8,275.8,275.8,472,460,440,78.7,75.7,71.1,120.1,318,304,350,400,79,120.3,95.1,351,145,301,121],[110,110,93,110,175,105,245,62,95,123,123,180,180,180,205,215,230,66,52,65,97,150,150,245,175,66,91,113,264,175,335,109],[3.9,3.9,3.85,3.08,3.15,2.76,3.21,3.69,3.92,3.92,3.92,3.07,3.07,3.07,2.93,3,3.23,4.08,4.93,4.22,3.7,2.76,3.15,3.73,3.08,4.08,4.43,3.77,4.22,3.62,3.54,4.11],[2.62,2.875,2.32,3.215,3.44,3.46,3.57,3.19,3.15,3.44,3.44,4.07,3.73,3.78,5.25,5.424,5.345,2.2,1.615,1.835,2.465,3.52,3.435,3.84,3.845,1.935,2.14,1.513,3.17,2.77,3.57,2.78],[16.46,17.02,18.61,19.44,17.02,20.22,15.84,20,22.9,18.3,18.9,17.4,17.6,18,17.98,17.82,17.42,19.47,18.52,19.9,20.01,16.87,17.3,15.41,17.05,18.9,16.7,16.9,14.5,15.5,14.6,18.6],[0,0,1,1,0,1,0,1,1,1,1,0,0,0,0,0,0,1,1,1,1,0,0,0,0,1,0,1,0,0,0,1],[1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,0,0,0,0,0,1,1,1,1,1,1,1],[4,4,4,3,3,3,3,4,4,4,4,3,3,3,3,3,3,4,4,4,3,3,3,3,3,4,5,5,5,5,5,4],[4,4,1,1,2,1,4,2,2,4,4,3,3,3,4,4,4,1,2,1,1,2,2,4,2,1,2,2,4,6,8,2]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>mpg<\/th>\n      <th>cyl<\/th>\n      <th>disp<\/th>\n      <th>hp<\/th>\n      <th>drat<\/th>\n      <th>wt<\/th>\n      <th>qsec<\/th>\n      <th>vs<\/th>\n      <th>am<\/th>\n      <th>gear<\/th>\n      <th>carb<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[1,2,3,4,5,6,7,8,9,10,11]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
<p>The variables include such things as fuel economy (<code>mpg</code>), the cylinder displacement (<code>disp</code>), whether the car had an automatic transmission (<code>am</code>) or a V-shaped engine (<code>vs</code>), and the number of carburetors. (<code>carb</code>. Ask your grandparent what a carburetor is.) We won’t be concerned here with the mechanics of how these cars worked. (But I do point out how poor the fuel economy was compared to today’s cars. A Datsun 710 is a small, low-performance car and it got just 22.8 mpg, not much better than a Maserati Bora.) Our interest here is just with the mechanics and meaning of solving <span class="math inline">\(\overrightarrow{\mathbf M}\cdot \vec{x} \approx \vec{b}\)</span>.</p>
<p>As an example, let’s consider the time it takes each car to go one-quarter mile from a standing start: the variable <code>qsec</code>. And let’s suppose we hypothesize that the engine power (<code>hp</code>: horsepower) is a major factor. A starting analysis might look like this: a graph of the data with a sketch of a straight-line model, then quantitative calculation of the model using <code>lm()</code>. As you will see when you run the code in the following sandbox <code>qsec</code> tends to go down (that is, get faster) with increasing horsepower. The coefficients give the slope and intercept of the least-squares straight-line model: for every 100 extra horsepower, the quarter-second time goes down (on average) by 1.8 seconds.</p>
<div class="sourceCode" id="cb55"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb55-1"><a href="least-squares.html#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="fu">gf_point</span>(qsec <span class="sc">~</span> hp, <span class="at">data =</span> mtcars) <span class="sc">%&gt;%</span></span>
<span id="cb55-2"><a href="least-squares.html#cb55-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gf_lm</span>(<span class="at">interval =</span> <span class="st">&quot;confidence&quot;</span>)</span></code></pre></div>
<p><img src="MOSAIC-Calculus_files/figure-html/unnamed-chunk-46-1.png" width="90%" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb56"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb56-1"><a href="least-squares.html#cb56-1" aria-hidden="true" tabindex="-1"></a>model <span class="ot">&lt;-</span> <span class="fu">lm</span>(qsec <span class="sc">~</span> hp, <span class="at">data =</span> mtcars)</span>
<span id="cb56-2"><a href="least-squares.html#cb56-2" aria-hidden="true" tabindex="-1"></a><span class="fu">coef</span>(model) <span class="co"># report model coefficients</span></span></code></pre></div>
<pre><code>## (Intercept)          hp 
## 20.55635402 -0.01845831</code></pre>
<div class="sourceCode" id="cb58"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb58-1"><a href="least-squares.html#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rsquared</span>(model) <span class="co"># report R-squared</span></span></code></pre></div>
<pre><code>## [1] 0.5015804</code></pre>
<p>::: {.example data-latex=""}</p>
<p>Turn this question into an example.
<strong>Question F</strong> What about the coefficients indicates that <code>qsec</code> goes down (on average) with <code>hp</code>?</p>
<ol style="list-style-type: lower-roman">
<li><span class="Zchoice">The sign of the <code>hp</code> coefficient.<span class="mcanswer">Right! </span></span><br />
</li>
<li><span class="Zchoice">Nothing about the coefficients. It’s the graph that shows this.<span class="mcanswer">︎✘ The graph does indeed show the going-down pattern. In fact, the straight line shown on the graph is exactly that represented by the coefficients. But the coefficients contain all the information we need to draw the line in the <code>gf_lm()</code> layer</span></span><br />
</li>
<li><span class="Zchoice">That the intercept is greater than the <code>hp</code> coefficient.<span class="mcanswer">︎✘ </span></span></li>
</ol>
<p>“R-squared” is a simple statistical summary of the model. A typical description of R-squared might be, “<code>hp</code> explains about 47% of the variation in <code>qsec</code>.” (There’s much more to be said about the statistics of the model. You can see a standard statistical report by using the command <code>summary(model)</code>.)</p>
</div>
<div id="lm-and-qr.solve" class="section level2" number="5.5">
<h2><span class="header-section-number">42.5</span> <code>lm()</code> and <code>qr.solve</code></h2>
<p>In this section, we’re going to see how <code>qr.solve()</code> is the essential engine of <code>lm()</code>. The following sandbox repeats the model-building command and omits the graphic (to save space). You’re going to add additional commands to translate the model into its <code>qr.solve()</code> equivalent.</p>
<div class="sourceCode" id="cb60"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb60-1"><a href="least-squares.html#cb60-1" aria-hidden="true" tabindex="-1"></a>model <span class="ot">&lt;-</span> <span class="fu">lm</span>(qsec <span class="sc">~</span> hp, <span class="at">data =</span> mtcars)</span>
<span id="cb60-2"><a href="least-squares.html#cb60-2" aria-hidden="true" tabindex="-1"></a>M <span class="ot">&lt;-</span> <span class="fu">model.matrix</span>(qsec <span class="sc">~</span> hp, <span class="at">data =</span> mtcars)</span>
<span id="cb60-3"><a href="least-squares.html#cb60-3" aria-hidden="true" tabindex="-1"></a>M</span></code></pre></div>
<pre><code>##                     (Intercept)  hp
## Mazda RX4                     1 110
## Mazda RX4 Wag                 1 110
## Datsun 710                    1  93
## Hornet 4 Drive                1 110
## Hornet Sportabout             1 175
## Valiant                       1 105
## Duster 360                    1 245
## Merc 240D                     1  62
## Merc 230                      1  95
## Merc 280                      1 123
## Merc 280C                     1 123
## Merc 450SE                    1 180
## Merc 450SL                    1 180
## Merc 450SLC                   1 180
## Cadillac Fleetwood            1 205
## Lincoln Continental           1 215
## Chrysler Imperial             1 230
## Fiat 128                      1  66
## Honda Civic                   1  52
## Toyota Corolla                1  65
## Toyota Corona                 1  97
## Dodge Challenger              1 150
## AMC Javelin                   1 150
## Camaro Z28                    1 245
## Pontiac Firebird              1 175
## Fiat X1-9                     1  66
## Porsche 914-2                 1  91
## Lotus Europa                  1 113
## Ford Pantera L                1 264
## Ferrari Dino                  1 175
## Maserati Bora                 1 335
## Volvo 142E                    1 109
## attr(,&quot;assign&quot;)
## [1] 0 1</code></pre>
<p>The inputs to <code>qr.solve()</code> are the matrix <code>M</code> and the target vector <code>b</code>.</p>
<p>In linear modeling, the matrix <code>M</code> is called the “model matrix.” There’s a convenient function, <code>model.matrix()</code> that will construct the matrix from a tilde expression and a data frame. Notice that the arguments for <code>model.matrix()</code> are exactly the same as in the corresponding call to <code>lm()</code>. Run the code to see the resulting <code>M</code>.</p>
<p>::: {.example data-latex=""}
Turn this into an example about how names are given to the coefficients.
<strong>Question G</strong> The <code>model.matrix()</code> function gives names to the individual vectors in <code>M</code>. What are these names?</p>
<ol style="list-style-type: lower-roman">
<li><span class="Zchoice">(Intercept) and hp<span class="mcanswer">Excellent! </span></span><br />
</li>
<li><span class="Zchoice">Merc 230 and Pontiac Firebird<span class="mcanswer">︎✘ </span></span><br />
</li>
<li><span class="Zchoice"><span class="math inline">\(\vec{u}\)</span> and <span class="math inline">\(\vec{v}\)</span><span class="mcanswer">︎✘ </span></span><br />
</li>
<li><span class="Zchoice"><code>[[1] 0 1</code><span class="mcanswer">︎✘ </span></span></li>
</ol>
<p>In Block 1, we had a variety of functions with something in common, such as …</p>
<p><span class="math display">\[f(x) \equiv m x + B\\
g(x) \equiv A \sin(\frac{2\pi}{P}t) + C\\
h(x) \equiv A e^{k t} + C\]</span></p>
<blockquote>
<p>Question: <em>Explain how an <code>(Intercept)</code> vector relates to one of the coefficients in each of these functions.</em></p>
</blockquote>
<p>Now for <span class="math inline">\(\vec{b}\)</span>. To create the target vector <span class="math inline">\(\vec{b}\)</span>, the <code>lm()</code> function looks to the variable named on the left side of the tilde expression (namely, <code>qsec</code>). It simply grabs that variable, unaltered, from the data frame. You can do this directly by adding the following command to the end of the sandbox:</p>
<pre><code>b &lt;- mtcars$qsec</code></pre>
<blockquote>
<p>Question: <em>Once you have constructed <code>M</code> and <code>b</code> as described above, use them to find the <code>\vec{x}</code> that satisfies <code>M\vec{x}≈\vec{b}</code>. Explain what <code>x</code> matches in the <code>model</code> created by <code>lm()</code>.</em></p>
</blockquote>
</div>
<div id="r2-residuals-etc." class="section level2" number="5.6">
<h2><span class="header-section-number">42.6</span> R<span class="math inline">\(^2\)</span>, Residuals, etc.</h2>
<div class="intheworld">
<p>Little - r</p>
</div>
<p>The sandbox below recapitulates the commands used to create <code>M</code> and <code>b</code> for the <code>qsec ~ hp</code> model and from them to calculate <code>x</code>.</p>
<div class="sourceCode" id="cb63"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb63-1"><a href="least-squares.html#cb63-1" aria-hidden="true" tabindex="-1"></a>M <span class="ot">&lt;-</span> <span class="fu">model.matrix</span>(qsec <span class="sc">~</span> hp, <span class="at">data =</span> mtcars)</span>
<span id="cb63-2"><a href="least-squares.html#cb63-2" aria-hidden="true" tabindex="-1"></a>b <span class="ot">&lt;-</span> mtcars<span class="sc">$</span>qsec</span>
<span id="cb63-3"><a href="least-squares.html#cb63-3" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">qr.solve</span>(M, b)</span></code></pre></div>
<p>Add to the sandbox a command to calculate <span class="math inline">\(\widehat{\ {b}\ }\)</span>. Call this vector <code>bhat</code>.</p>
<p><strong>Question H</strong> What is the <strong>square of the length</strong> of <code>bhat</code>? (Hint: the square of the length is even easier to calculate than the length.)</p>
<ol style="list-style-type: lower-roman">
<li><span class="Zchoice">3780.4<span class="mcanswer">Correct. </span></span><br />
</li>
<li><span class="Zchoice">12<span class="mcanswer">︎✘ That’s how many components there are in <code>bhat</code>. The length refers to the sizes of the components.</span></span><br />
</li>
<li><span class="Zchoice">3805.5<span class="mcanswer">︎✘ That’s the length of <code>b</code>. We’re asking about <code>bhat</code>.</span></span><br />
</li>
<li><span class="Zchoice"><code>bhat</code> is a vector.<span class="mcanswer">︎✘ True. But what is the length of the vector?</span></span></li>
</ol>
<p>In statistics, the amount of <code>b</code> that is explained by the model is the length of a vector closely related to <code>bhat</code>. Add this command to the sandbox:</p>
<pre><code>explained_vec &lt;- bhat - mean(bhat)</code></pre>
<p>Similarly, the amount to explain is the length of this vector:</p>
<pre><code>to_explain_vec &lt;- b - mean(b)</code></pre>
<blockquote>
<p><em>There is a simple relationship between R-squared (which was 47.1%) and the squared lengths of <code>explained_vec</code> and <code>to_explain_vec</code>. Figure it out and say what it is.</em></p>
</blockquote>
</div>
<div id="modern-fitting-the-ridge-and-the-lasso-optional" class="section level2" number="5.7">
<h2><span class="header-section-number">42.7</span> Modern fitting: The ridge and the lasso (optional)</h2>

</div>
</div>






            </section>

          </div>
        </div>
      </div>
<a href="target-problem.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page"><i class="fa fa-angle-left"></i></a>

    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": false,
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/dtkaplan/MOSAIC-Calculus/shared/B5-least-squares.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": "https://github.com/dtkaplan/MOSAIC-Calculus/shared/B5-least-squares.Rmd",
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "section"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
